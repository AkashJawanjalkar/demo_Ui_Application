<mvc:View
    controllerName="project1.controller.View2"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:u="sap.ui.unified"
    xmlns:table="sap.ui.table"
    xmlns:f="sap.m"
    class="viewPadding"
>
    <f:Page title="" showNavButton="false" class="view2Root pageSoftBG">
        <f:customHeader>
            <f:Bar>
                <f:contentLeft>
                    <f:Title text="" class="pageHeaderTitle" />
                </f:contentLeft>
            </f:Bar>
        </f:customHeader>

        <content>
            <VBox class="sapUiSmallMargin" width="100%" renderType="Bare" alignItems="Center">
                <items>

                    <!-- Upload Actions Panel -->
                    <Panel headerText="Upload Actions"
                           class="sapUiMediumMarginBottom panelPolish professionalCard centerContainerWidth wideContainerWidth">
                        <VBox class="sapUiSmallMargin">
                            <HBox alignItems="Center" justifyContent="SpaceBetween" class="sapUiSmallMarginBottom">
                                <!-- Left aligned buttons -->
                                <HBox>
                                    <Button text="Download Sample"
                                            icon="sap-icon://download"
                                            type="Emphasized"
                                            class="sapUiTinyMarginEnd"
                                            press=".onDownloadSample" />
                                </HBox>

                                <!-- Right aligned -->
                                <HBox alignItems="Center">
                                    <!-- FileUploader -->
                                    <u:FileUploader id="fileUploader"
                                                    name="uploadFile"
                                                    tooltip="Upload your XLSX file"
                                                    fileType="xlsx"
                                                    placeholder="Choose Excel file"
                                                    sameFilenameAllowed="false"
                                                    uploadOnChange="false"
                                                    change=".onFileChange"
                                                    style="Emphasized"
                                                    class="sapUiTinyMarginEnd" />
                                    <!-- Upload button -->
                                    <Button text="Upload File"
                                            icon="sap-icon://upload"
                                            type="Emphasized"
                                            press=".onUploadPress"
                                            class="sapUiTinyMarginEnd primaryActionButton" />
                                </HBox>
                            </HBox>
                        </VBox>
                    </Panel>

                    <!-- Uploaded Data Panel -->
                    <Panel headerText="Uploaded Data Preview"
                           width="100%"
                           class="professionalCard panelPolish centerContainerWidth wideContainerWidth"
                           expandable="false"
                           expanded="true"
                           > 

                        <Title text="Uploaded Data" level="H2" class="sapUiSmallMarginBottom" />

                        <headerToolbar>
                            <Toolbar design="Transparent">
                                <ToolbarSpacer />
                                <Button text="Download File"
                                        icon="sap-icon://download"
                                        type="Transparent"
                                        visible="{viewModel>/isFileUploaded}"
                                        press=".onDownloadUploadedData"
                                        class="sapUiTinyMarginEnd sapUiTinyMarginTop" />
                            </Toolbar>
                        </headerToolbar>

                        <!-- Table -->
                        <table:Table id="previewTable"
                                     visible="false"
                                     rows="{preview>/data}"
                                     selectionMode="None"
                                     enableColumnReordering="true"
                                     enableCellFilter="true"
                                     rowHeight="15"
                                     visibleRowCount="10"
                                     visibleRowCountMode="Fixed"> <!-- ðŸ‘ˆ Fixed rows instead of deprecated prop -->
                            <table:columns>
                                <table:Column width="6rem" hAlign="Center">
                                    <Label text="Edit" />
                                    <table:template>
                                        <Button icon="sap-icon://edit" type="Transparent" press=".onEditRowPress" tooltip="Edit row"/>
                                    </table:template>
                                </table:Column>
                                <table:Column filterProperty="BatchNo" sortProperty="BatchNo" width="8em">
                                    <Label text="Batch No" />
                                    <table:template>
                                        <Text text="{preview>BatchNo}" />
                                    </table:template>
                                </table:Column>

                                <table:Column filterProperty="ComponentCode" sortProperty="ComponentCode" width="8em">
                                    <Label text="Component Code" />
                                    <table:template>
                                        <Text text="{preview>ComponentCode}" />
                                    </table:template>
                                </table:Column>

                                <table:Column filterProperty="PackingSite" sortProperty="PackingSite" width="8em">
                                    <Label text="PackingSite ID" />
                                    <table:template>
                                        <Text text="{preview>PackingSite}" />
                                    </table:template>
                                </table:Column>

                                <table:Column filterProperty="PackingDate" sortProperty="PackingDate" width="8em">
                                    <Label text="Packing Date" />
                                    <table:template>
                                        <Text text="{preview>PackingDate}" />
                                    </table:template>
                                </table:Column>

                                <table:Column filterProperty="ReleaseDate" sortProperty="ReleaseDate" width="8em">
                                    <Label text="Release Date" />
                                    <table:template>
                                        <Text text="{preview>ReleaseDate}" />
                                    </table:template>
                                </table:Column>

                                <table:Column filterProperty="Comments" sortProperty="Comments" width="8em">
                                    <Label text="Comments" />
                                    <table:template>
                                        <Text text="{preview>Comments}" />
                                    </table:template>
                                </table:Column>

                                <table:Column width="20em">
                                    <Label text="Error" />
                                    <table:template>
                                        <Text text="{preview>Error}" wrapping="true" />
                                    </table:template>
                                </table:Column>
                            </table:columns>
                        </table:Table>
                    </Panel>
                </items>
            </VBox>
        </content>

        <!-- Dependents: Row Edit Dialog -->
        <f:dependents>
            <Dialog id="editDialog" title="Edit Row" stretchOnPhone="true" contentWidth="25rem">
                <VBox class="sapUiMediumMargin">
                    <Label text="Batch No"/>
                    <Input value="{edit>/BatchNo}" editable="true"/>

                    <Label text="Component Code" class="sapUiSmallMarginTop"/>
                    <Input value="{edit>/ComponentCode}" editable="true"/>

                    <Label text="PackingSite" class="sapUiSmallMarginTop"/>
                    <Input value="{edit>/PackingSite}" editable="true"/>

                    <Label text="Packing Date (DD/MM/YYYY)" class="sapUiSmallMarginTop"/>
                    <DatePicker value="{edit>/PackingDate}" displayFormat="dd/MM/yyyy" valueFormat="dd/MM/yyyy" placeholder="DD/MM/YYYY"/>

                    <Label text="Release Date (DD/MM/YYYY)" class="sapUiSmallMarginTop"/>
                    <DatePicker value="{edit>/ReleaseDate}" displayFormat="dd/MM/yyyy" valueFormat="dd/MM/yyyy" placeholder="DD/MM/YYYY"/>
                </VBox>
                <beginButton>
                    <Button text="Save" type="Emphasized" press=".onEditSave"/>
                </beginButton>
                <endButton>
                    <Button text="Cancel" type="Transparent" press=".onEditCancel"/>
                </endButton>
            </Dialog>
        </f:dependents>

        <!-- Footer -->
        <f:footer>
            <Toolbar>
                <ToolbarSpacer/>
                <Button text="Reset"
                        icon="sap-icon://reset"
                        type="Transparent"
                        press=".onReset"
                        class="secondaryActionButton"
                        enabled="{viewModel>/isFileUploaded}"/>
                <Button text="Submit"
                        type="Accept"
                        icon="sap-icon://action"
                        press=".onSubmitData"
                        enabled="{viewModel>/isFileUploaded}"
                        id="submitBtn"
                        class="primaryActionButton"/>
            </Toolbar>
        </f:footer>
    </f:Page>
</mvc:View>
